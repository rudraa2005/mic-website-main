<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Profile - MAHE Innovation Centre</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .liquid-glass {
      background: rgba(255, 255, 255, .1);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, .2);
      box-shadow: 0 8px 32px rgba(31, 38, 135, .37);
    }

    .liquid-glass::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, .4), rgba(255, 255, 255, .1));
      border-radius: inherit;
      z-index: -1;
    }

    .nav-link::before {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 50%;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #ff6b35, #ff8c42);
      transition: all .3s ease;
      transform: translateX(-50%);
      border-radius: 2px;
    }

    .nav-link:hover::before {
      width: 100%;
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Profile tiles - subtle black cards with slow pop hover */
    .profile-tile {
      position: relative;
      background: #000000;
      color: #ffffff;
      border: 1px solid rgba(255, 107, 53, 0.45);
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.5);
      transition: transform 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94),
        box-shadow 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94),
        background 0.45s ease;
      transform-origin: center;
    }

    .profile-tile:hover {
      background: linear-gradient(135deg, #111827 0%, #cc572b 100%);
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 28px 56px rgba(0, 0, 0, 0.75);
    }

    /* Profile header tile (user photo area) - glass rectangle with slow pop */
    .profile-header-tile {
      position: relative;
      background: rgba(255, 255, 255, 0.16);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-radius: 1.75rem;
      padding: 1.75rem 2.5rem;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.45);
      border: 1px solid rgba(255, 255, 255, 0.35);
      transition: transform 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94),
        box-shadow 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94),
        background 0.55s ease;
      transform-origin: center;
    }

    .profile-header-tile:hover {
      transform: translateY(-10px);
      box-shadow: 0 28px 70px rgba(15, 23, 42, 0.7);
      background: rgba(255, 255, 255, 0.24);
    }

    /* Dark Mode Styles */
    body.dark-mode {
      background: #0f172a;
      color: #e2e8f0;
    }

    body.dark-mode .bg-gray-50,
    body.dark-mode .bg-gray-100,
    body.dark-mode .bg-gray-200 {
      background: #1e293b !important;
    }

    body.dark-mode .bg-gray-900 {
      background: #0f172a !important;
    }

    body.dark-mode .text-gray-800,
    body.dark-mode .text-gray-900 {
      color: #e2e8f0 !important;
    }

    body.dark-mode .text-gray-600,
    body.dark-mode .text-gray-700 {
      color: #cbd5e1 !important;
    }

    body.dark-mode .text-gray-500 {
      color: #94a3b8 !important;
    }

    body.dark-mode .text-gray-400 {
      color: #94a3b8 !important;
    }

    body.dark-mode .text-white {
      color: #f8fafc !important;
    }

    body.dark-mode .text-black {
      color: #f8fafc !important;
    }

    body.dark-mode .liquid-glass {
      background: rgba(30, 41, 59, 0.8) !important;
    }

    body.dark-mode .nav-link {
      color: #cbd5e1 !important;
    }

    body.dark-mode .nav-link:hover {
      color: #ff6b35 !important;
    }

    body.dark-mode .bg-white {
      background: #1e293b !important;
    }

    body.dark-mode .bg-gray-800 {
      background: #1e293b !important;
    }

    body.dark-mode .border-gray-800 {
      border-color: #1e293b !important;
    }

    body.dark-mode .border-gray-700 {
      border-color: #334155 !important;
    }

    body.dark-mode .glass-card {
      background: rgba(30, 41, 59, 0.8) !important;
    }

    /* Chatbot widget */
    .chatbot-panel {
      box-shadow: 0 25px 50px -12px rgba(15, 23, 42, 0.45);
      background: #e7e3dd;
      background-image:
        radial-gradient(220px at 8% 20%, rgba(255, 115, 29, 0.9) 0%, rgba(255, 115, 29, 0.75) 60%, transparent 61%),
        radial-gradient(180px at 92% 8%, rgba(247, 242, 234, 0.95) 0%, rgba(247, 242, 234, 0.85) 70%, transparent 71%),
        radial-gradient(200px at 90% 85%, rgba(255, 140, 66, 0.9) 0%, rgba(255, 140, 66, 0.8) 65%, transparent 66%),
        linear-gradient(180deg, #e7e3dd 0%, #e7e3dd 100%);
    }

    .chatbot-header {
      background: #0f172a;
    }

    .chatbot-input-wrap {
      background: linear-gradient(135deg, #ff7a1a, #ff8c42);
      box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3);
    }

    .chatbot-input-field {
      background: #f8f7f4;
      color: #0f172a;
    }

    .chatbot-input-field::placeholder {
      color: #a1a1aa;
    }

    .chatbot-pill {
      background: rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.12);
    }

    body.dark-mode .chatbot-panel {
      background: #0f172a;
      background-image:
        radial-gradient(220px at 8% 20%, rgba(255, 115, 29, 0.75) 0%, rgba(255, 115, 29, 0.55) 60%, transparent 61%),
        radial-gradient(180px at 92% 8%, rgba(30, 41, 59, 0.9) 0%, rgba(30, 41, 59, 0.8) 70%, transparent 71%),
        radial-gradient(200px at 90% 85%, rgba(255, 140, 66, 0.7) 0%, rgba(255, 140, 66, 0.55) 65%, transparent 66%),
        linear-gradient(180deg, #0f172a 0%, #0f172a 100%);
      border-color: #334155 !important;
      color: #e2e8f0;
    }

    body.dark-mode .chatbot-header {
      background: #0b1120;
    }

    body.dark-mode .chatbot-input-wrap {
      background: linear-gradient(135deg, #ff7a1a, #ff8c42);
    }

    body.dark-mode .chatbot-input-field {
      background: #0b1225;
      color: #e2e8f0;
    }

    body.dark-mode .chatbot-input-field::placeholder {
      color: #94a3b8;
    }

    body.dark-mode .chatbot-pill {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(255, 255, 255, 0.12);
    }
  </style>
  <script>
    tailwind.config = { theme: { extend: { colors: { 'orange-primary': '#ff6b35', 'orange-secondary': '#ff8c42' }, fontFamily: { inter: ['Inter', 'sans-serif'] } } } }
  </script>
</head>

<body class="bg-gray-200 font-inter overflow-x-hidden">
  <!-- Navigation -->
  <nav class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-11/12 max-w-6xl">
    <div class="liquid-glass rounded-full px-6 py-3 relative">
      <div class="flex justify-between items-center">
        <div class="flex items-center space-x-2">
          <div
            class="w-8 h-8 bg-gradient-to-br from-orange-primary to-orange-secondary rounded-lg flex items-center justify-center">
            <span class="text-white font-bold text-sm">M</span>
          </div>
          <span class="text-gray-800 font-semibold text-lg">MAHE</span>
        </div>
        <div class="hidden md:flex items-center space-x-8 ml-auto">
          <a href="index-tailwind.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">Home</a>
          <a href="about.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">About Us</a>
          <a href="events.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">Events</a>
          <a href="work.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">Works</a>
          <a href="resources.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">Resources</a>
          <a href="contact.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">Contact</a>
        </div>
        <div class="hidden md:flex items-center space-x-4 ml-4">
          <a href="profile.html"
            class="w-10 h-10 rounded-full bg-orange-primary text-white flex items-center justify-center">
            <i class="fas fa-user"></i>
          </a>
        </div>
        <button class="md:hidden text-gray-700" id="mobile-menu-btn"><i class="fas fa-bars text-xl"></i></button>
      </div>
      <!-- Mobile Menu -->
      <div id="mobile-menu" class="hidden md:hidden mt-4 pb-2">
        <div class="flex flex-col space-y-4">
          <a href="index-tailwind.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">Home</a>
          <a href="about.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">About Us</a>
          <a href="events.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">Events</a>
          <a href="work.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">Works</a>
          <a href="resources.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">Resources</a>
          <a href="contact.html"
            class="nav-link relative text-gray-700 hover:text-orange-primary transition-colors font-medium">Contact</a>
          <a href="profile.html"
            class="w-10 h-10 rounded-full bg-orange-primary text-white flex items-center justify-center">
            <i class="fas fa-user"></i>
          </a>
        </div>
      </div>
    </div>
    </div>
  </nav>

  <!-- Profile Content -->
  <section class="pt-32 pb-24 bg-gray-50">
    <div class="container mx-auto px-6 lg:px-12">
      <div class="glass-card rounded-3xl p-8 lg:p-12 relative border border-white/30 bg-white/20">
        <div class="flex flex-col lg:flex-row items-start lg:space-x-12">
          <!-- Profile Picture and Info (Left on desktop) -->
          <div class="flex flex-col items-center text-center w-full lg:w-1/2 profile-header-tile order-1">
            <div class="relative">
              <img id="profile-photo" src="https://via.placeholder.com/150" alt="User Photo"
                class="w-40 h-40 rounded-full border-4 border-orange-primary object-cover"
                style="object-fit: cover; width: 160px; height: 160px;">
              <input type="file" id="photo-input" accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                style="display: none;">
              <button id="upload-photo-btn"
                class="absolute bottom-2 right-2 w-10 h-10 bg-orange-primary rounded-full text-white flex items-center justify-center hover:bg-orange-secondary transition-colors cursor-pointer">
                <i class="fas fa-camera"></i>
              </button>
            </div>
            <h2 id="profile-name" class="text-3xl font-bold text-gray-800 mt-6">Loading...</h2>
            <p id="profile-email" class="text-gray-600 mt-2">Loading...</p>
            <p id="profile-phone" class="text-gray-600 mt-1" style="display: none;"></p>
            <div id="upload-status" class="mt-2 text-sm" style="display: none;"></div>
          </div>

          <!-- Feature Links (Right on desktop) -->
          <div class="w-full lg:w-1/2 order-2 mt-12 lg:mt-0">
            <div class="flex flex-col gap-4">
              <a href="submissions.html" class="glass-card profile-tile rounded-xl p-6 flex items-center space-x-4">
                <i class="fas fa-file-alt text-3xl text-orange-primary"></i>
                <div>
                  <h3 class="text-xl font-bold text-white">Submissions</h3>
                  <p class="text-gray-300">View your past submissions</p>
                </div>
              </a>
              <a href="progress.html" class="glass-card profile-tile rounded-xl p-6 flex items-center space-x-4">
                <i class="fas fa-chart-line text-3xl text-orange-primary"></i>
                <div>
                  <h3 class="text-xl font-bold text-white">Progress</h3>
                  <p class="text-gray-300">Track your application progress</p>
                </div>
              </a>
              <a href="feedback.html" class="glass-card profile-tile rounded-xl p-6 flex items-center space-x-4">
                <i class="fas fa-comment-dots text-3xl text-orange-primary"></i>
                <div>
                  <h3 class="text-xl font-bold text-white">Feedback</h3>
                  <p class="text-gray-300">See feedback on your proposals</p>
                </div>
              </a>
              <a href="ai-insight.html" class="glass-card profile-tile rounded-xl p-6 flex items-center space-x-4">
                <i class="fas fa-lightbulb text-3xl text-orange-primary"></i>
                <div>
                  <h3 class="text-xl font-bold text-white">AI Insight</h3>
                  <p class="text-gray-300">Get AI-powered insights</p>
                </div>
              </a>
              <a href="settings.html" class="glass-card profile-tile rounded-xl p-6 flex items-center space-x-4">
                <i class="fas fa-cog text-3xl text-orange-primary"></i>
                <div>
                  <h3 class="text-xl font-bold text-white">Settings</h3>
                  <p class="text-gray-300">Manage your account settings</p>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-16">
    <div class="container mx-auto px-6 lg:px-12">
      <div class="grid lg:grid-cols-2 gap-12 mb-12">
        <div>
          <h3 class="text-2xl font-semibold mb-6 max-w-sm">Subscribe to our newsletter for the latest features and
            updates.</h3>
          <form class="flex flex-col sm:flex-row gap-4 mb-4" id="newsletterForm">
            <input type="email" placeholder="Your Email Here" required
              class="flex-1 px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-orange-primary transition-colors" />
            <button type="submit"
              class="bg-orange-primary text-white px-8 py-3 rounded-lg font-semibold hover:bg-orange-secondary transition-colors">Subscribe</button>
          </form>
          <p class="text-sm text-gray-400">By subscribing, you consent to our Privacy Policy and receive updates.</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div>
            <h4 class="font-bold mb-6 uppercase tracking-wider">Useful Links</h4>
            <ul class="space-y-3">
              <li><a href="about.html" class="text-gray-400 hover:text-orange-primary transition-colors">About Us</a>
              </li>
              <li><a href="contact.html" class="text-gray-400 hover:text-orange-primary transition-colors">Contact
                  Us</a></li>
              <li><a href="events.html" class="text-gray-400 hover:text-orange-primary transition-colors">Events</a>
              </li>
              <li><a href="resources.html"
                  class="text-gray-400 hover:text-orange-primary transition-colors">Resources</a></li>
              <li><a href="index-tailwind.html"
                  class="text-gray-400 hover:text-orange-primary transition-colors">Home</a></li>
            </ul>
          </div>
          <div>
            <h4 class="font-bold mb-6 uppercase tracking-wider">Company</h4>
            <ul class="space-y-3">
              <li><a href="#" class="text-gray-400 hover:text-orange-primary transition-colors">Our Team</a></li>
              <li><a href="#" class="text-gray-400 hover:text-orange-primary transition-colors">Leadership</a></li>
              <li><a href="#" class="text-gray-400 hover:text-orange-primary transition-colors">Careers</a></li>
              <li><a href="#" class="text-gray-400 hover:text-orange-primary transition-colors">Press</a></li>
              <li><a href="#" class="text-gray-400 hover:text-orange-primary transition-colors">Purpose</a></li>
            </ul>
          </div>
          <div>
            <h4 class="font-bold mb-6 uppercase tracking-wider">Follow Us</h4>
            <div class="space-y-3">
              <a href="#"
                class="flex items-center space-x-2 text-gray-400 hover:text-orange-primary transition-colors"><i
                  class="fab fa-facebook"></i><span>Facebook</span></a>
              <a href="#"
                class="flex items-center space-x-2 text-gray-400 hover:text-orange-primary transition-colors"><i
                  class="fab fa-instagram"></i><span>Instagram</span></a>
              <a href="#"
                class="flex items-center space-x-2 text-gray-400 hover:text-orange-primary transition-colors"><i
                  class="fab fa-twitter"></i><span>Twitter</span></a>
              <a href="#"
                class="flex items-center space-x-2 text-gray-400 hover:text-orange-primary transition-colors"><i
                  class="fab fa-linkedin"></i><span>LinkedIn</span></a>
              <a href="#"
                class="flex items-center space-x-2 text-gray-400 hover:text-orange-primary transition-colors"><i
                  class="fab fa-youtube"></i><span>YouTube</span></a>
            </div>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center">
        <p class="text-gray-400 text-sm mb-4 md:mb-0">Â© MAHE INNOVATION CENTRE</p>
        <div class="flex space-x-6">
          <a href="#" class="text-gray-400 hover:text-orange-primary transition-colors text-sm">Privacy Policy</a>
          <a href="#" class="text-gray-400 hover:text-orange-primary transition-colors text-sm">Terms of Service</a>
          <a href="#" class="text-gray-400 hover:text-orange-primary transition-colors text-sm">Cookie Settings</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Chatbot Widget -->
  <link rel="stylesheet" href="assets/chatbot.css">
  <script src="assets/chatbot.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      setTimeout(function () {
        const defaultLauncher = document.getElementById('mahe-chatbot-launcher');
        if (defaultLauncher) defaultLauncher.style.display = 'none';
        const customLauncher = document.createElement('button');
        customLauncher.className = 'fixed bottom-6 right-6 z-50 w-14 h-14 rounded-full bg-gradient-to-br from-orange-primary to-orange-secondary text-white shadow-xl flex items-center justify-center hover:scale-110 transition-all duration-300';
        customLauncher.setAttribute('aria-label', 'Open Chatbot');
        customLauncher.innerHTML = '<i class="fas fa-comments text-2xl"></i>';
        customLauncher.onclick = function () { if (window.MaheChatbot) window.MaheChatbot.open(); };
        document.body.appendChild(customLauncher);
      }, 100);
    });
  </script>

  <script>
    // Load profile data
    (async function () {
      const token = localStorage.getItem('authToken');
      if (!token) {
        // Redirect to login if not authenticated
        window.location.href = 'login.html';
        return;
      }

      try {
        const response = await fetch('/api/profile/me', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          if (response.status === 401) {
            // Unauthorized - clear token and redirect to login
            localStorage.removeItem('authToken');
            window.location.href = 'login.html';
            return;
          }
          throw new Error('Failed to load profile');
        }

        const profile = await response.json();

        // Update profile display
        document.getElementById('profile-name').textContent = profile.name == "" ? "[EMPTY NAME]" : profile.name;
        document.getElementById('profile-email').textContent = profile.email || '';

        if (profile.phone) {
          const phoneElement = document.getElementById('profile-phone');
          phoneElement.textContent = profile.phone;
          phoneElement.style.display = 'block';
        }

        if (profile.photo_url) {
          const photoElement = document.getElementById('profile-photo');
          photoElement.src = profile.photo_url;
        }
      } catch (error) {
        console.error('Error loading profile:', error);
        alert('Failed to load profile. Please try again.');
      }
    })();

    // Photo upload functionality
    (function () {
      const photoInput = document.getElementById('photo-input');
      const uploadBtn = document.getElementById('upload-photo-btn');
      const uploadStatus = document.getElementById('upload-status');
      const profilePhoto = document.getElementById('profile-photo');

      // Trigger file input when camera button is clicked
      uploadBtn?.addEventListener('click', function () {
        photoInput?.click();
      });

      // Handle file selection
      photoInput?.addEventListener('change', async function (e) {
        const file = e.target.files?.[0];
        if (!file) return;

        // Validate file type
        const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
        if (!validTypes.includes(file.type)) {
          alert('Invalid file type. Please select a JPEG, PNG, GIF, or WebP image.');
          return;
        }

        // Validate file size (10MB max)
        if (file.size > 10 * 1024 * 1024) {
          alert('File size too large. Please select an image smaller than 10MB.');
          return;
        }

        const token = localStorage.getItem('authToken');
        if (!token) {
          window.location.href = 'login.html';
          return;
        }

        // Show upload status
        uploadStatus.style.display = 'block';
        uploadStatus.textContent = 'Uploading...';
        uploadStatus.className = 'mt-2 text-sm text-orange-primary';

        try {
          const formData = new FormData();
          formData.append('photo', file);

          const response = await fetch('/api/profile/photo', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`
            },
            body: formData
          });

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(errorText || 'Upload failed');
          }

          const result = await response.json();

          // Update photo display
          if (result.photo_url) {
            profilePhoto.src = result.photo_url;
            // Force reload to ensure proper display
            profilePhoto.onload = function () {
              uploadStatus.textContent = 'Photo updated successfully!';
              uploadStatus.className = 'mt-2 text-sm text-green-600';
              setTimeout(() => {
                uploadStatus.style.display = 'none';
              }, 3000);
            };
          }

        } catch (error) {
          console.error('Error uploading photo:', error);
          uploadStatus.textContent = 'Failed to upload photo. Please try again.';
          uploadStatus.className = 'mt-2 text-sm text-red-600';
          setTimeout(() => {
            uploadStatus.style.display = 'none';
          }, 5000);
        } finally {
          // Reset file input
          photoInput.value = '';
        }
      });
    })();

    // Mobile menu toggle
    document.getElementById('mobile-menu-btn')?.addEventListener('click', function () {
      const menu = document.getElementById('mobile-menu');
      menu.classList.toggle('hidden');
    });

    // Newsletter form handling
    document.getElementById('newsletterForm')?.addEventListener('submit', function (e) {
      e.preventDefault();
      alert('Thank you for subscribing! We\'ll keep you updated.');
      this.reset();
    });

    // Dark mode initialization
    (function () {
      const savedTheme = localStorage.getItem('theme');
      const savedSystemTheme = localStorage.getItem('systemTheme');
      const body = document.body;

      function applySystemTheme() {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          body.classList.add('dark-mode');
        } else {
          body.classList.remove('dark-mode');
        }
      }

      if (savedSystemTheme === 'true') {
        applySystemTheme();
        if (window.matchMedia) {
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applySystemTheme);
        }
      } else if (savedTheme === 'dark') {
        body.classList.add('dark-mode');
      }
    })();

  </script>
</body>

</html>